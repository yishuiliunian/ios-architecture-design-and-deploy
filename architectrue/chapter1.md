# 架构是什么

## 架构是什么

_”一千人眼中有一千个哈姆雷特“_，但是一千个人眼中是否有一千种架构？我的观察是的，貌似“架构”就是一个巨大的池子，但凡有点技术含量的事情都可以扔进这个概念里面，做了些跨端的事情是架构；说要mvc往mvvm迁移也是架构；oc升级swift也算架构；组件化也是架构.....不胜枚举。大有一种架构等同于技术深度的味道。而另外一方面，架构的本职工作“组件化”，缺被无数的leader在追问其价值与意义，潜台词大概是这个东西和目前的业务关系比较远，且ROI不明确，为什么要做呢？经过无数轮的讨论、白扯、说服、狡辩...最后结论我们也做吧，因为XXX也在做。我的经验是如果一个事情没法说清楚他的价值，大概是没有对齐他的定义。"名不正，则言不顺；言不顺，则事不成；事不成，则礼乐不兴；礼乐不兴，则刑罚不中；刑罚不中，则民无所措手足"。于是回到了最开始的问题：架构是什么？

先不做正面回答，我们从侧面来说几个事情，以把架构这个概念具象化。

### Infrastructure VS Architecture

第一个事情是区分一下基础设施和架构，因为这是最容易混淆在一起说的两个词。国内大一点的客户端组织，可能都会成立一个“基础架构”组。每当我看到这个名字的时候，我都迷糊的想问，这个要是翻译成英文是 Infrastructure 还是 Architecture。仔细观察一下他们做的事情，结果发现，还是翻译成 Infrastructure 比较合适一点。因为他们做的多是一些只做一些框架（framework）或者功能库（library）的事情，或者打一个又一个的“战役”，突击一下 hotfix、动态化、容器化等等看起来非常 sex 的事情。所以感觉还是叫 Infrastructure 基础设施更合适一点。所谓的基础设施，大概就是其他同学工作的基础工具或者素材。而这些正是符合这些点的。

《人月神话》的中文版中，在谈到组织内分工的时候有一个名词“结构师”。初看觉得翻译者翻译的有点粗糙，这个名字应该翻译成“架构师”才对嘛。后来，随着对于**架构**理解深入，越咂摸越有味道。窃以为，这个“结构师“才是对于”架构师“工作比较准确的阐述。架构师，应该是组织内那群最关注”结构“的人，所以直接叫做”结构师”也未尝不可。这种结构可以从不同维度张开来看。

最底层代码执行的流程结构；再往上，函数之间的调用结构；再往上，类结构；再往上，组件结构；再往上，模块结构；再往上，服务调用结构；再往上，业务结构...

这些结构需要被设计，同时也需要被维护。所以就有了“架构“，也就有了”架构师“，然后也就应该有 ”Architecture“ 这样的组织。

### 结构之于架构

在《人月神话》中，作者无数次提到”概念完整性&一致性“。为了能够落地概念完整性和一致性，结构是关键的途径。结构本身就是对于某个工程的最高抽象。也是对抗规模带来的复杂性的利剑。关于复杂性，在后面将会单独来讲，因为他太重要了。而所谓做架构，大概也就是去设计“结构”，并且维护”结构“。

一般意义上，我们说的”架构“，更倾向于表达高维的结构。至少是组件往上的层次。如果硬要咬文嚼字，那么组件往下的“结构”，也算是“架构”的一部分，毕竟也是在处理“结构”，这样一来“人人都是架构师”（模仿一本叫做人人都是产品经理的书）；但实际情况是我们还是觉得“架构师”是一个比较高大上的职位，一般是经验比较丰富的同学来做的。于是，这里的结构我们更关注一些高维或者高度抽象的概念及其结构。

而结构是什么？不玩俄罗斯套娃，嵌套问了。对于结构应该大家的概念还是比较一致的，无需多言。

### 团队组织之于架构

康威定律说，设计系统的架构受制于产生这些设计的组织的沟通结构。这句话，每次想引用都得先 google，因为着实有点拗口。说的通俗点，系统结构并不是凭空产生，也不是独立存在的，他必然与所在的团队有千丝万缕的联系。所以在设计系统结构的时候，往往需要考虑到所处的组织环境，尤其是业务环境和人员组织结构。团队的组织形式即生产关系，对于一个研发团队来讲，其生产资料除了代码之外，文档和信息也是非常重要的生产资料。这些信息的流动结构和顺序也是决定一个组织效率的重要因素。

举个常见的例子吧，比如组件化这个事情。我们在做分层的时候，往往会切出来一个叫做”业务层“。大概是把一些比较纯粹的业务单元，放在这个层次。而又因为某些业务天然的隔离关系，会由不同的团队来承接对应的业务。于是在业务层中就会出现其对应的”业务组件“。一个业务组件会对应一个团队，一个团队会对应一个业务。这大概就是组织本身与我们进行结构设计上的强耦合。



### 流程之于架构

同结构一样，”流程“也是一个泛指的概念。因为，结构是个静态的概念。必须让其动起来，才能够对于现实产生价值。这个用另外一个比喻就是，初始设计出来的系统结构就是一个二进制可执行文件，而流程就是把他执行起来。一个只能”躺列“的架构设计文档，大概只是个摆设；只有执行落地了，才会发会期价值。当然，落地的方式有很多中，比如转换成 framework （框架）。而另外一种非常重要的方式是转化成流程。流程设计也是架构的一部分啊，因为他设计的是整个系统的“动态结构”。

我们都熟悉了 `程序 = 数据结构 + 算法` 的抽象。再来看一下架构，其实也是类似 `架构 = 结构 + 流程`。一个关注静态结构，一个关注动态结构。整个系统运转起来会是什么样子。当然，这个系统并非是单纯的指我们的代码和工程，而是包含团队组织内的各种各样的只能角色。所以这个抽象，可以从很多个层面上展开来看。

还是拿组件化举例子吧，并不是说我们做外分层和拆库，组件化就完成了。我们还需要考虑到组件的生命周期，研发同学们怎么去创建组件、使用组件；又是怎么基于组件结构来进行沟通，和迭代他们的程序。而这些就是流程。

### 复杂性之于架构

复杂性是一切问题的源头，架构只不过伴随工程整个生命周期的重要的“保镖”。是对抗复杂性的重要的利剑。如果没有复杂性，那么架构存在的价值与意义可能会非常弱。要不是团队规模和工程规模会膨胀到极度复杂的程序，哪里需要用组件化这种东西；要不是服务规模膨胀到了极度复杂的程序，哪里需要微服务这种架构模式。一般情况下我们所说的复杂性，主要包含认知复杂性和固有复杂性。认知复杂性是说，我们人脑无法处理不了这个问题了，毕竟人脑的处理是有瓶颈的。而固有复杂性，则是指系统的固有规模，就像写一个算1+1等于几的程序，与做一个类似于滴滴这样的私家车调度系统完全不是一个量级。正式因为这些复杂，我们才需要“架构”这个“保镖”。让整个工程不会因为复杂性而被拖垮。毕竟，我们听够无数个因为复杂性过高，系统技术债务过度，然后新需求迭代不动的例子。

只要工程还在迭代，变得更加复杂是必然的趋势。因为对于系统而言，“熵增”是必然趋势。而所谓“熵增”则是混乱程度增加。字面意思里面，混乱程度增加了，那么复杂度也水涨船高。而架构的终极目标是在工程系统中构建一个“耗散结构”来抵抗熵增。让系统从无序不断趋近于有序，或者不会阻止系统朝着无序一路狂奔。

### 架构

所以我们回过来头来看，架构是我们通过“结构”和“流程”来对抗复杂性的过程，其作用对象是工程本身和工程所处的组织及业务环境，终极目标是构建一个”耗散结构“来抵抗系统熵增导致的复杂性。

诚然这也是一个片面的定义，因为我们忽略架构设计本身的业务价值。例如在大型系统中，通过架构设计来让实现业务变为可能。但是吧，如果硬要诡辩，这个东西也可以说成是因为系统过于复杂而需要进行架构设计。

### 架构的价值与意义

> 善战者无赫赫之功 善医者无煌煌之名。

一个非常可悲的问题是，在目前的环境下貌似没有一个很好的评估体系能够很好的评估“架构”。我眼瞅着并亲身经历了，在一个团队内部，组建了几波“架构”组织，然后又被“拆散”了几波。感受着来自 leaders&pairs 对于架构的价值与意义的质问，对结果的怀疑；也经历过对自己工作价值与意义的否定。终于有一天开悟: 善战者无赫赫之功，善医者无煌煌之名。架构作为 ”保镖“ 的工作，他存在的意义就是不出问题。而实际情况是，很多时候评价者习惯了 STAR 的面试法则，往往在晋升的时候 PPT 里面，会看到这样的描述：遇到了XX问题，我做了XX，于是问题解决了，拿到了XX的结果。这更像是一个医生的思路，诊断出来这有问题了，然后要么开药，要么动刀子。结果非常好衡量，因为惊天动地的动了一场手术，过程很轰动，病人并也好了。所以这个医生是个牛逼的医生啊。而”架构“工作可没有这样的表现机会。

像搞搞”组件化“，团队和工程都因为这个还”伤筋动骨“，可能短时间内效率还是降低的。从 ROI 角度思考，这绝逼是个亏本买卖。干不干？不干！ROI 思维，在资源有限的情况下处理单点问题是利器。但是当需要做一些探索的事情，价值判断链条过长的事情的时候，或者系统性的问题，就会变成桎梏。我们说要做长期主义的朋友，但是 ROI 思维，在某些意义上绝对是长期主义的敌人。而”架构“正是对工程可持续性的投资，很多时候这种投资无法在中短期看到明显的收益，但是如果不做，那么将会有一天”君有疾在骨髓，司命之所属，无奈何也“。你永远不要高估保健品的短期价值，也永远不要低估保健品的长期价值。

所以，有些时候再有人问我架构的价值与意义，会略显无赖的说”正在做这个事情“本身就是其价值与意义。在评估”架构“这个事情的时候，”信仰“大于ROI。评估者信复杂性会导致工程灾难，则有价值；不信，或者用单点的 ROI 评估，则价值存疑。记得有次交流有人问我，要不要做客户端研发工具，我反问：你leader 信吗，他回答说：leader说可以先试试。我说，你不要做了，将会费力不讨好。

玄幻一点说，上述意义上的”架构“，是一种”工程信仰“。大抵如此。

其实，这有点跑题。因为我们还是强调了复杂性的部分，忽略了架构设计本身的事情。这个可能是因为，对于”客户端“这个工程域来讲，其实是没有那么多的机会去做”DDD“，去领域建模、去做系统建模、业务建模这些事情的。而做的更多的一些工作，是在与复杂性做对抗。做一些治理性的工作，例如组件化、性能治理、资源治理、代码规范治理、单测推进等等的一些看来比较琐碎的工作。这些工作，结果不好拿，也不好评估。现在如果你也在做客户端，也经历过这些，还会觉得“架构”是个 sex 的事情吗？如果是，那么恭喜你也是个有工程信仰的同学。接着往下看。

## 架构成本

一个比较尴尬的问题是，当你进行架构活动的时候，也会给整个系统引入更多的“复杂性”。天下没有免费的午餐，架构活动也是需要付出成本的。成本可以从多个维度考虑，例如：人员成本、团队成本、技术成本、机会成本...当然对于绝大多数的互联网公司而言，人员成本在技术类的岗位招聘考虑的相对比重较低，尤其是架构岗位。在《人月神话》里面，说一般一个优秀的程序员的效率往往是一般程序员的5倍。一样的道理，同样是做架构的同学，其个体差异也很大。而这些差异很难用薪资来衡量。另外一方面，薪资这个东西吧，一旦付出了就是“沉没成本”，他换来的是人，而要通过人来实现其他的价值。

同时，这里我们主要看的是：技术成本、机会成本和团队成本。

### 因为架构活动引入的技术成本

举个例子来讲，例如进行“组件化”。会更整个工程与引入一些新的概念：组件化、组件、依赖管理、语义化版本... 在整个工程与中引入更多的概念或者实体，势必会提高整体系统的“认知复杂度”。然后乍看起来，系统是不是更复杂了？可能是的，但是这种复杂与原始混乱的复杂是不一样的。一种是可以被认知，一种不可被认知。




